(self["webpackChunkdraw"]=self["webpackChunkdraw"]||[]).push([[90],{7090:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});s(71);var n=s(3673),a=s(8880),o=s(2323);const l=(0,n.Uk)(" Drawing App "),i={key:1};function r(e,t,s,r,u,m){const c=(0,n.up)("q-badge"),g=(0,n.up)("q-btn"),d=(0,n.up)("q-toolbar-title"),p=(0,n.up)("q-toolbar"),h=(0,n.up)("ChatBox"),w=(0,n.up)("q-drawer"),k=(0,n.up)("q-header"),f=(0,n.up)("router-view"),v=(0,n.up)("q-page-container"),W=(0,n.up)("q-layout");return(0,n.wg)(),(0,n.j4)(W,{view:"lHh Lpr lFf"},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{elevated:""},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,{flat:"",dense:"",round:"",icon:"chat","aria-label":"Menu",onClick:t[1]||(t[1]=e=>u.leftDrawer=!0)},{default:(0,n.w5)((()=>[(0,n.Wm)(a.uT,{"enter-active-class":"animated bounceInLeft"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(c,{color:"orange",floating:""},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(u.unreadMsgsCount),1)])),_:1},512),[[a.F8,u.unreadMsgsCount]])])),_:1})])),_:1}),(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[l])),_:1}),u.showPing?((0,n.wg)(),(0,n.j4)("div",i,[(0,n.Wm)(g,{label:m.getPingText,onClick:m.stopPinging},null,8,["label","onClick"])])):((0,n.wg)(),(0,n.j4)("div",{key:0,onClick:t[2]||(t[2]=(...e)=>m.startPinging&&m.startPinging(...e))},[(0,n.Wm)(g,{label:"Show ping"})])),(0,n.Wm)(g,{icon:"logout",color:"negative",class:"q-pa-sm",onClick:m.logout},null,8,["onClick"])])),_:1}),(0,n.Wm)(w,{modelValue:u.leftDrawer,"onUpdate:modelValue":t[3]||(t[3]=e=>u.leftDrawer=e),dark:""},{default:(0,n.w5)((()=>[(0,n.Wm)(h)])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(v,null,{default:(0,n.w5)((()=>[(0,n.Wm)(f)])),_:1})])),_:1})}const u={class:"q-pa-md bg-dark",style:{"min-height":"80vh"}},m=(0,n.Wm)("div",{class:"q-my-xl"},[(0,n.Wm)("span",{class:"text-h3"},"ChatBox")],-1),c={class:"text-right"},g={class:"q-mb-lg"},d={class:"text-white"};function p(e,t,s,l,i,r){const p=(0,n.up)("q-icon"),h=(0,n.up)("q-avatar"),w=(0,n.up)("q-chip"),k=(0,n.up)("q-chat-message"),f=(0,n.up)("q-scroll-area"),v=(0,n.up)("q-input");return(0,n.wg)(),(0,n.j4)("div",u,[m,(0,n.Wm)("div",c," ðŸŸ¢ "+(0,o.zw)(Object.keys(e.$store.state.usersList).length)+" Online",1),(0,n.Wm)("div",g,[((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(e.$store.state.usersList,((e,t)=>((0,n.wg)(),(0,n.j4)("span",{key:t},[(0,n.Wm)(w,{color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{name:"person",color:"white"})])),_:1}),(0,n.Wm)("span",d,(0,o.zw)(e.username),1)])),_:2},1024)])))),128))]),(0,n.Wm)(f,{ref:"scrollArea",style:{height:"55vh"}},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{class:"q-mx-md",name:"Server",text:["hey","how are you?"]}),((0,n.wg)(!0),(0,n.j4)(n.HY,null,(0,n.Ko)(r.getMsgsData,((e,t)=>((0,n.wg)(),(0,n.j4)(k,{class:"q-mx-md",key:t,name:e.username,text:e.text,sent:e.username==i.socket.username,stamp:r.getTimespamp(e.time)},null,8,["name","text","sent","stamp"])))),128))])),_:1},512),(0,n.Wm)("div",null,[(0,n.Wm)(v,{modelValue:i.input,"onUpdate:modelValue":t[1]||(t[1]=e=>i.input=e),class:"q-mt-md",rounded:"",outlined:"",label:"message",dark:"",onKeydown:(0,a.D2)(r.send,["enter"])},{append:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{name:"send",onClick:r.send},null,8,["onClick"])])),_:1})])),_:1},8,["modelValue","onKeydown"])])])}const h={data(){return{socket:{},input:"",updateTime:0,msgsData:this.$store.state.msgsData,usersList:this.$store.state.usersList}},computed:{getUsersCount(){return console.log(this.usersList),Object.keys(this.usersList).length},getMsgsData(){return this.$store.state.msgsData}},mounted(){this.socket=this.$store.state.socket,setTimeout((()=>{this.socket.emit("getUsersList")}),500),this.socket.on("receiveUsersList",(e=>{console.log(e),this.$store.commit("updateUsersList",e)})),this.socket.on("receiveMsg",(e=>{this.appendNewMsg(e),this.animateScroll()})),setInterval((()=>{}),1e3)},methods:{animateScroll(){console.log("scrolling"),this.$refs.scrollArea.setScrollPosition("vertical",1e4,300)},getTimespamp(e){const t=Date.now(),s=t-e,n=Math.ceil(s/1e3);return n>3600?`${Math.ceil(n/3600)}h ago`:n>60?`${Math.ceil(n/60)}m ago`:`${n}s ago`},send(){if(""==this.input)return;let e={username:this.socket.username,text:[this.input],time:Date.now()};this.socket.emit("sendMsg",e),this.appendNewMsg(e),this.animateScroll(),this.input=""},appendNewMsg(e){this.$store.commit("appendNewMsgData",e)}}};var w=s(7030),k=s(5096),f=s(4554),v=s(7704),W=s(629),q=s(4196),C=s(7518),M=s.n(C);h.render=p;const y=h;M()(h,"components",{QChip:w.Z,QAvatar:k.Z,QIcon:f.Z,QScrollArea:v.Z,QChatMessage:W.Z,QInput:q.Z});const b={name:"MainLayout",components:{ChatBox:y},data(){return{leftDrawer:!1,unreadMsgsCount:0,socket:{},showPing:!1,ping:"pinging...",pingInterval:null}},computed:{getPingText(){return`${this.ping} ms`}},watch:{leftDrawer:function(){this.unreadMsgsCount=0}},mounted(){this.socket=this.$store.state.socket,this.socket.on("receiveMsg",(()=>{this.unreadMsgsCount++})),this.socket.on("ping",(e=>{this.ping=Date.now()-e}))},methods:{logout(){localStorage.setItem("username",""),this.$router.go(),this.$q.notify({message:"Logged out!",color:"negative"})},startPinging(){this.showPing=!0,this.pingInterval=setInterval((()=>{this.socket.emit("ping",Date.now())}),1e3)},stopPinging(){this.showPing=!1,clearInterval(this.pingInterval)}}};var D=s(9214),x=s(3812),$=s(9570),L=s(9892),Q=s(9721),Z=s(3747),_=s(2901),P=s(2652);b.render=r;const j=b;M()(b,"components",{QLayout:D.Z,QHeader:x.Z,QToolbar:$.Z,QBtn:L.Z,QBadge:Q.Z,QToolbarTitle:Z.Z,QDrawer:_.Z,QPageContainer:P.Z})}}]);